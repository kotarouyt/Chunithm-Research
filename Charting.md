ゲーム内で使用されている譜面ファイル(c2s)に関する参考資料です。このファイルは、c2sのノーツの配置やBPMなど、曲の構造を示しています。

# 前提で知っておいたほうがいいこと

* この資料は100％正確であることを保証するものではありません。一部のタグ等は仮定に基づくものであり、さらなる研究が必要な場合があります。
* c2s譜面ファイルフォーマットでは、大体のカウントは0から始まります。0小節は曲の始まり、0セルは左の最初のセル、などを意味します。
* 譜面ファイルの場所は「root¥app¥data¥AXXX¥music¥musicXXXX」にあります。譜面ファイルのファイル形式は前述で何回も言っている通り「.c2s」で「Notepad++」などのツールで開けるプレーンテキストファイルです。
* セルは、プレイフィールド上のノーツに対応する鍵盤です。プレイフィールドは16列で、左から0～15の数字が並んでいます。
* 小節は、特定の拍数を含む時間の関数です。各小節は基本的に4拍で構成されており、曲全体を通して比較的一定です。
* 自分の経験的に、Chunithmは、譜面ファイルが非常に特殊な方法で書かれているため、既存の書き方に乗っ取っていない書き方の場合、記述されたノーツは描画されません。。既存の譜面ファイルでは、ノーツに修飾を加えるためにスペースキーではなく、タブキーを使うとうまくいきます。スペースキーでやるとうまくいきません。（なおこれはNotepad++を使った場合の話です、別のやつとか使ったら違うかも。）
* Chunithmは、選択時に「.c2s」ファイルを再読み込みします。てことはだよ？、変更される曲を再選択するだけで、カスタム譜面をデバッグすることが可能なんです！この作業を効率化するために、"今わの際 "などのDANGERスキルを使用する。※1(スキルID 102005）を使用し、カスタムノーツの数小節後に≈20 TAPノートを配置します。こうすることで、曲が終わるのを待たずに、自動的に終了し、より早く再選択することができます。

※1 CHUNITHM NEWであるかどうかは忘れました。


# タグ達

## VERSION

バージョンが設定されているよ。よくわからんけど、まあ「1.08.00」にしたら動くからこれでいいと思う。(CHUNITHM自体のバージョンかなと思ったんだけどちがそうだしよくわからん)

## MUSIC

まあこれは大体「0」になってる。(昔のバージョンとか、Music.xmlがなかったからその時のタグが残りっぱなしなんだと思う)

## SEQUENCEID

これもだいたい「0」

## DIFFICULT

これもですね、うん大体「0.0」になってるよ。(さっきも言ったけど、昔のバージョンとかMusic.xmlがなかったからその時のタグだと思うよ。)

## LEVEL

言わずもがな、これも「0.0」になってます。(3回目ですけど、うん、昔のバージョンとかMusic.xmlがなかったらその時のタグだと思うよ。)

## CREATOR

譜面製作者の名前だよー。難易度がBASICとかADVANCEDになってない限り選曲画面の曲の左下に名前が表示されるよ！

## BPM_DEF

名前のまんま。デフォルトのBPM

### スキーマ(図):

| 1 | 2 | 3 | 4 |
| ---- | ---- | ---- | ---- |

「1」は通常、デフォルトBPMです。つまり曲の始まりのBPMだよ。「2」は通常とか、あとは別のBPM、まあ要は、「1」が頻繁に使うやつだとしたらその次に頻繁に使うBPM的な？
まあ別のBPMがないんだったら、「2＝1」でいいよ。「3」と「4」は「2」と「1」と同じらしい。


## RESOLUTION

曲の解像度を指定するよ。ここは絶対「384」になってるよ。

## CLK_DEF

ここも絶対「384」になってる。

## PROGJUDGE_BPM

ここは「240.000」に絶対なってるよ。

## PROGJUDGE_AER

ここはね～毎回「0.999」になってるんだよね。わあすごい。

## TUTORIAL

この譜面がチュートリアルの譜面かどうかだよ。

## BPM

見たらわかるくない？BPMです。BPM。

### スキーマ(図):

| 開始小節 | オフセット | BPM |
| ---- | ---- | ---- |

## MET

曲の拍子だよ。

### スキーマ(図):

| 開始小節 | オフセット | 2番目の値 | 1番目の値 |
| ---- | ---- | ---- | ---- |

拍子の値が逆になってるのは、非常に非常に重要だよ。あと、これは結構外観上のことだよっていうことを言っておく。
この値が影響するのはプレイフィールド上の細かい小節線の配置だけだよ。

## SFL

指定された小節でのスクロール速度を指定するよ。

### スキーマ(図):

| 開始小節 | オフセット | デュレーション | どんだけ早くするか |
| ---- | ---- | ---- | ---- |

注意することなんだけど、どんだけ早くするかの値が「0.000001」であること、つまり小数点以下6桁でなければならなきゃいけないんだよね。この数値に基づいてノーツが早くなったり遅くなったりするよ。この値は外観上のもので、マイナスとかにすると逆に動くよ。(太鼓さん次郎のスクロールみたいだよね。)基本的に、[Fracture RayのMASTERチャートのこの部分](https://youtu.be/5m7bMyIDoec?t=48)みたいな、おもしろ目的(？)のために使われるよ。

# ノーツ達

## 大体ノーツってこういう感じのスキーマ(図)になってるよ。

| ノーツタイプ | 小節 | オフセット | セル | 幅 |
| ---- | ---- | ---- | ---- | ---- |

### ノーツタイプ

ノーツタイプは、特定の場所にに配置したいノーツを記述するものだよ。使えるノーツにはいろんなやつがあるよ。
下で説明してるから見てね。


#### ノーツの種類:

* TAP (タップ)
* CHR (ex-タップ(黄色い光るやつ))
* HLD (ホールド)
* SLD (スライド)
* SLC (スライド中継地点)
* FLK (フリック)
* AIR (エアー)
* AUR (右上エアー)
* AUL (左上エアー)
* AHD (エアーで手あげたままにするやつ)
* ADW (エアーダウン)
* ADR (右下エアー)
* ADL (左下エアー)
* MNE (ダメージ(青のやつ))

### 小節

小節は、ノーツを配置したい特定の小節を示すものだよ。各小節は（大体）4拍子になってる。値は0から始まって、無限に続くけど、曲が終わったら終わるようにしてね。

### オフセット

ノーツとかタイミングポイントとかがどのタイミングで始めたらいいかの関数だよ。これは、解像度タグで指定された曲の解像度に依存するんだよね。解像度が384の場合(ていうかまあだいたいそうなってるとおもうけど)、小節の最初のビートは「0」、2番目は「96」、3番目は「192」、4番目は「288」となります。自分がやりたい拍子を割り出すためには、解像度を4で割り、それに自分がしたい拍子を掛けてから、解像度を4で割った値を引きます。

端数のビートを得るには、解像度を4で割って、それに必要なビートの端数を掛けます。そして、その結果と希望するビートを足します。

この場合の関数は次のようになります。

b = 小数点以下を切り捨てた自分がしたい拍子
r = 解像度
f = 拍子の分数

```b(r/4)-(r/4) + f(r/4)```


例えば、解像度が384の4拍子の曲の2拍半の無音が欲しい時は、次のようにしよう。

```
2(384/4)-(384/4) + 1/2(384/4)
192 - 96 + 48
144
```


### セル

さっきも書いたけど、この「セル」には、ノーツが表示されるべきプレイフィールドの列の数値IDが入るよ(0～15)。これは、**セルは左から0~15となってること**を注意しておくことが必要だよ。

### 幅

「セル」の数値とは別に、「幅」の数値は、セルに記載されている数値から**右方向**に伸びるノーツの幅を指定するよ。最小値は1で、もし1だったらノーツがセルに記載された列だけ描画されることを意味するよ。
他に、セルの数値が7で、ノーツの幅が3だとすると、ノーツはプレイフィールド上のセル番号「7、8、9」列を占めることになるよ。

## その他ノーツの値に関する情報

大体のノーツ達は、しっかり描画されるために追加の情報を書き込むよ。このセクションでは、ノーツが使用するスキーマ(図)の例を見て、その後、
一般的なスキーマ(図)に示されていない値について解説するよ。引用符で囲まれた値は、そのノーツと一致する値を載せてるよ。


### タップ

タップだよ。まあ言わずもがなだよね、めちゃくちゃ基本形だよ。プレイするときはタップすればいいだけだね。

#### スキーマ(図):

| "Tap" | 小節 | オフセット | セル | 幅 |
| ---- | ---- | ---- | ---- | ---- |

ん？さっき見た気がするって？ああ。そうそう。タップはさっき説明した基本形と同じだよ。楽だね～。

### ex-タップ(黄色い光るやつ)

Ex-タップは普通のタップと似てるけど正確に打てば打つほどスコアが違うよ！

#### スキーマ(図):

| "CHR" | 小節 | オフセット | セル | 幅 | エフェクトの種類 |
| ---- | ---- | ---- | ---- | ---- | ---- |

* エフェクトの種類: みんな知ってるかどうかわからないんだけど、CHUNITHMってEx-タップのエフェクトが3種類(あっNEWになって増えたんだっけ？)があるんだよね。それの指定。(UPとかCEとかDWとかあるよ(NEWではもっと増えてるかも！！！))

### ホールド

これ、一回一回説明する必要ある？まあ一応しとくと、あれね、タップノーツをずっと押す版みたいなね。

#### スキーマ(図): 

| "CHR" | 小節 | オフセット | セル | 幅 | デュレーション |
| ---- | ---- | ---- | ---- | ---- | ---- |

* デュレーション: どんだけ押し続けるか的な。さっき説明したオフセットとおんなじ感じの値の計算方法を使ってるよ。

### スライド

あれあれ、あのーそう、ホールドノーツと似てるけど、スライドノーツは押しながら移動できるんだね...というかさっきから思ってるけどこの資料読んでる人絶対こういう知識あるよね、これ毎回説明する必要あります？
スライドノーツには、SLDとSLCの2種類があるよ。直線で始まるスライドはSLDで始まり、すぐに動き出すスライドはSLCで始まる。すべてのスライドはSLDノートで終わる。

#### スキーマ(図):

| "SLD"/"SLC" | 小節 | オフセット | セル | 幅 | デュレーション | 終わるセル | 終わる幅 |
| ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- |

* デュレーション: どんだけ押し続けるか的な。さっき説明したオフセットとおんなじ感じの値の計算方法を使ってるよ。
* 終わるセル: スライドの継続時間中にスライドが移動する列。セルの値と同様に、0～15の範囲で設定できるよ。スライドが持続時間中、まっすぐなままなようにするには、終わるセルの値をセルの値と同じにする。
* 終わる幅: 持続時間の終了時になってるスライド幅だよ。幅の値とおんなじように、この値は0～15の間の任意の場所に設定することができるよ。終わる幅が幅と違ったら、スライドの途中ででかくなったり小さくなったりするよ。

スライドは、別のスライドがある同じセルでSLDを呼び出すまで、その後に別のスライドが続くことなく終了します。連続したスライドの途中でSLDを呼び出すと、
その特定のポイントに青いノーツが追加されますが、これは純粋に外観上のものです。別のノーツを追加せずにスライドを調整するには、SLCを使用します。

スライドは、プレイフィールド上のセルでSLDを呼び出さないと、すぐに終了されちゃうよ。スライドの途中でSLDを呼び出すと
青いノーツが追加されるよ。けどまあ外観上のものだよ。音は出るけどね。見えないように調整するにはSLCを使用しよう。

スライドがなんか色々綺麗に曲がったり色々するのはそういうのがあるんじゃなくてすっげえ小さい値の中でこのスライド関数が呼び出されてるからだよ。(下に説明あり。)

### フリック

...言う必要あるこれ？えっと、フリックです。横にフリックします。以上です。

#### スキーマ(図):

| "FLK" | 小節 | オフセット | セル | 幅 | エフェクトの種類 |
| ---- | ---- | ---- | ---- | ---- | ---- |

* エフェクトの種類: まあ、基本的にLでいいよ。多分Rもある。あれね、フリックした時によく見ると下の方にエフェクトが見えるんだけどその方向だと思うよ。

### エアー

エアーだよエアー！手をあげよう！ウェイ！（?a）

#### スキーマ(図):

| "AIR"/"AUR"/"AUL" | 小節 | オフセット | セル | 幅 | どのノーツにつけるか |
| ---- | ---- | ---- | ---- | ---- | ---- |

* AIR/AUR/AUL: AIRは上向き。AURは右上。AULは左上。最後のLとRで見ればわかりやすいね～。(絶対AIR UP LEFT/RIGHTの略だよね)
* どのノーツにつけるか: エアーノーツがどのノーツから出るかを指定するよ。つけたいノーツは、エアーノーツと同じセル、小節、あとはオフセットを同じにする必要があるよ。

## エアーホールド

手あげたままにするやつ。上手い人がくるくるやってるやつ。

#### スキーマ(図):

| "AHD" | 小節 | オフセット | セル | 幅 | どのノーツにつけるか | デュレーション |
| ---- | ---- | ---- | ---- | ---- | ---- | ---- |

* どのノーツにつけるか: エアーホールドがどの場所からするかを指定するよ。したいところで、エアーノーツと同じセル、小節、あとはオフセットを同じにする必要があるよ。
* デュレーション: どんだけ押し続けるか的な。さっき説明したオフセットとおんなじ感じの値の計算方法を使ってるよ

エアーアクションを作るためには、最初のエアーホールドを、エアーアクションを作りたいところまで作って、その後最初のエアーホールドと同じオフセットで開始する別のエアーホールドノーツを作るよ。

### エアーアクション

エアー中に手を下げるやつ。NEWだとここらへんがどうなってるかは知らん。なんか横とか動いてるし変わってそうだよね（笑）(←見てない)

#### スキーマ(図):

| "ADW"/"ADR"/"ADL" | 小節 | オフセット | セル | 幅 | どのノーツにつけるか |
| ---- | ---- | ---- | ---- | ---- | ---- |

* ADW/ADR/ADL: ADRが右下(AIR DOWN RIGHTの略だよね絶対) ADLが左下だよ。
* どのノーツにつけるか: エアーアクションをどこでするかを指定するよ。する場所と同じセル、小節、あとはオフセットを同じにする必要があるよ。

### 青のビリビリしてる痛いやつ

触っちゃだめだよ！World ENDでしか見たことないの自分だけ？

| "MNE" | 小節 | オフセット | セル | 幅 |
| ---- | ---- | ---- | ---- | ---- |

タップとおんなじだね～。

# ここでノーツのデモンストレーションをしよう

下のこれは解像度が386でCyaeghaのMASTERを再現したものだよ。

```
TAP	8	0	6	4
TAP	8	0	12	4
SLC	8	96	4	4	7	3	4
TAP	8	96	10	4
SLC	8	103	3	4	10	2	4
SLC	8	113	2	4	13	1	4
SLC	8	126	1	4	22	0	4
SLD	8	148	0	4	236	0	4
TAP	8	192	8	4
SLC	8	288	6	4	4	7	4
SLC	8	292	7	4	12	9	4
SLC	8	304	9	4	9	10	4
SLC	8	313	10	4	12	11	4
SLC	8	325	11	4	23	12	4
SLD	8	348	12	4	36	12	4
AHD	9	0	0	4	SLD	192
CHR	9	0	4	8	CE
AIR	9	0	4	8	CHR
AHD	9	0	12	4	SLD	192
TAP	9	288	3	4
TAP	9	288	9	4
```

どんな感じになってるのか分解して見ていこう。

![Demonstration of Cyaegha Excerpt](https://raw.githubusercontent.com/Suprnova123/Chunithm-Research/main/_assets/cyaegha%20example.gif)

まず冒頭の２つのタップ
```
TAP	8	0	6	4
TAP	8	0	12	4
```

こんな感じになってるよ

``タップノーツ | 8小節目 | オフセットは0 | 6セルと12セルから出発 |  4セル分右に伸びてるよ``


小節とオフセットが同じだから同時に来てるよね！。１番左からセルの番号は0～16ということを忘れないでおこうね。

次の２つのノーツはタップとスライドだよ。c2s内ではこうなってるね～。
```
SLC	8	96	4	4	7	3	4
TAP	8	96	10	4
```

スライダーがすぐ動いたから今回はSLCだったね～もしスライドが止まってたらSLDだったね。

そして、こうなってるよ

``スライドノーツ | 8小節目 | オフセット96 | 4セル目 | 4セル分右へ伸びる | ディレーション7 | 3セルで終わる | 終わりの幅は4``

ここでまず重要なことがあるんだけど、まず、小節が8でオフセットが96ということは、このノーツは8小節の2拍目に発生することを意味するよね？（オフセット0は1泊目だよ...）。
あと、ノーツの長さもめっちゃ短いじゃん。ディレーション7しかない、つまり、スライダは1小節のほぼ100分の2しか続かないということなんだ。こんなに短いのは、カーブを作るためだよ。
最初のスライダーノーツに、カーブにするためのノーツがついてるんだよね。(ベジェ曲線とか使ってないの凄いよね。)

タップノーツはこうなってるよ

``タップノーツ | 8小節目 | オフセット96 | セル10からスタート | 4セル分右へ``

ここでも同じ小節と同じオフセットだから２つのノーツは同時だね～。

次にくるのは、スライダーの中継地点と、新しいスライダーの作成、そしてタップノーツです。
それはこうなってます：
```
SLC	8	103	3	4	10	2	4
SLC	8	113	2	4	13	1	4
SLC	8	126	1	4	22	0	4
SLD	8	148	0	4	236	0	4
TAP	8	192	8	4
SLC	8	288	6	4	4	7	4
SLC	8	292	7	4	12	9	4
SLC	8	304	9	4	9	10	4
SLC	8	313	10	4	12	11	4
SLC	8	325	11	4	23	12	4
SLD	8	348	12	4	36	12	4
```

さてさて、又々重要なことだ。一つ目は、スライドノーツがめっちゃ連続して置いてあることなんだよね、まあこれはさっき言ったけど、これはきれいなカーブスライドを作るためだね。
その直後にSLDがあって、こちらは236のデュレーションとなっているよ。このスライダーは他のスライダーと同じタイミングで終了することになっていることがわかるね、
これはとても重要だよ。オフセット（148）とデュレーションを足すと、384という値になり、一番下の2番目のSLDのオフセットとデュレーションを足すと、384になります。同じ小節にあるので、互いに同じ時刻に終了することがわかるね。
また、2つ目のSLCのペアは、1つ目のペアとは関係ないよ。他のスライダーとは別のセルで始まるから、前のスライダーを延長するんじゃなくて、新しいスライドを生成するよ。

最後の部分には、エアーとエアーホールドとタップノーツかな？
こんな感じになってるよ：
```
AHD	9	0	0	4	SLD	192
CHR	9	0	4	8	CE
AIR	9	0	4	8	CHR
AHD	9	0	12	4	SLD	192
TAP	9	288	3	4
TAP	9	288	9	4
```

AHDもAIRもCHRも、小節とオフセットが共通なので、同じタイミングで始まっていることがわかるね。それでは、それぞれのノーツを分解して見てみよう！

AHDノーツ:

``エアーホールド | 9小節目 | オフセット0 | 0セル/12セルからスタート | 4セル分伸びる | SLDノーツと同じところから読み取る | デュレーション192``

ex-タップノーツ:

``ex-タップ | 9小節目 | オフセット0 | 4セル分伸びる | 8セル分伸びる | エフェクトの種類CE``

AIRノーツ:

``エアー | 9小節目 | オフセット0 | 4セル分伸びる | 8セル分伸びる | Ex-タップとおんなじところ``

タップノーツ:

``Tap note | 9小節目 | オフセット288 | 3セル/9セルからスタート | 4セル分伸びる``

以上でCyaeghaの抜粋部分解説を終わりにします。

# 終わりのタグ

**ノート:** これ書いても書かなくても変わらんらしい、カスタムチャートやる場合は無視でOK

## T_REC_XXX

``XXX`` はノーツタイプの略語に置き換えられ、``T_REC_ALL`` というフィールドが1つ追加されます。多分だけどノーツの数を数えてる？
T_REC_ALL`` は前の ``T_REC_XXX`` フィールドの値を足したものと同じになります。

## T_NOTE_XXX

T_REC_XXXと同じだと思うんだけど、、なんかおんなじ譜面なのに値が違う。

## T_NUM_XXX

T_REC_XXX、T_NOTE_XXXと同じだと思うけど、T_XXX_ALLはなく、代わりによくわからんのT_NUM_AACが存在する。


## T_CHRTYPE_XX

XXは、CHRノーツのエフェクトの種類の略語に置き換えられます。トラック内の指定した修飾子を持つCHRノーツの量をカウントするためのものだよ。


## T_LEN_XXX

``XXXX`` はスライド系ノーツの略語に置き換えられ、さらに ``T_LEN_ALL`` がありました。
``T_REC_XXX`` と同じように見えるけど、スライドノーツが有効であるミリ秒を数えるみたいだよ。
``T_LEN_ALL`` は、前の ``T_LEN_XXX`` の値を足したものになります。

## T_JUDGE_XXX

知らん。

## t_first_xxxx

T_FIRST_MSEC`` と ``T_FIRST_RES`` という2つのタグがあるよ。どちらも、最初のノーツのタイムスタンプをミリ秒単位で表しているよ。

## t_final_xxxx

T_FINAL_MSEC`` と ``T_FINAL_RES`` という二つのタグがあるっぽい。どちらも最後のノーツのタイムスタンプをミリ秒単位で、デュレーションを表している。これは譜面ファイルに記載されているノーツのタイムスタンプと同じじゃないよ。なんでかっていうと、ノーツが持続するとタイムスタンプはそのノーツが終了したときに移動するから。

## T_PROG_XX

20個のタグがあり、``T_PROG_00`` から始まり、最終タグの ``T_PROG_95`` まで、5個ずつ増えていきます。わからん。

# コスメティック

ゲーム内で見つけた外観上の面白そうな事を箇条書き形式で書いてるよ。役に立ててね。

## フリックノーツ

フリックノーツは、灰色のノーツの中に小さな青いノーツが入った形で表示されるよ。青いノーツは、フリックノーツの3分の1の大きさで、ノーツの中央に配置されているよ。

## エア/ダウンノーツ

エアノーツとダウンノーツには、ノーツの上か下に、そのノーツと同じ幅を持つ矢印が付いています。
これらのノーツの角度付きバージョンは、常に元のノーツのすぐ左または右のセルを指すような角度になっています。